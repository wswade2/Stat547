---
title: "Homework 6"
output: 
  html_document: 
    keep_md: yes
---

Welcome to homework 6! For this homework, I've been asked to choose from a list of 6 tasks. I have chosen to do tasks 2 and 6. I'll first be creating my own function and will finish up by exploring nested dataframes.

Prompt:
"Write a couple of experimental functions exploring some functionality that is useful to you in real life and that might form the basis of your personal package."

Because I work in the social sciences, I find myself doing a LOT of copy/pasting ggplot2 code for histograms and barplots. These figures constitute 75% of my "exploratory data analysis," so it would be very useful if I could automate this process. My goal then is to create a function that will produce histograms of every variable in any dataframe that I read into R. Afterwards, I would like to find a way to automate the generation of 2X2 barplots to show interation effects between two or more independent variables and a single dependent variable. Perhaps later this can serve as the basis for an R package of my creation. 

Some people might suggest plotting several histograms at once (in a single panel) using various R packages, but I find this clunky. I like being able to look at each variable in isolation. 

First, I'll read in some data. This is a dataset called EWB light that was collected by personality psychologists.

```{r}
ewb <- read.table("C:/Users/Wade/Dropbox/Psych 546E 2016/Datasets/ewblight.txt", header=TRUE)
head(ewb)
```

```{r}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(reshape2))
suppressPackageStartupMessages(library(psych))
# Psych is an R package developed for psychologists. It's mostly used to print tables of 
# summary statistics that are commonly used in psychology.
```

For loops follow the following syntax:

for (var in seq) {
  expr
}

That is to say: For each variable in this sequence (or each element in this set), execute this expression.

You can also insert a break statement if you don't want the for loop to be performed on the entire sequence. Ex:

for (var in seq) {
  if (nchar(var) > 10) {
  break
  }
  expr(var)
}
 
You can use "next" instead of break if you want to skip a variable. 

```{r}
names <- names(ewb)
names(ewb)
classes<-sapply(ewb, class)
```


```{r}
for(name in names) {
 hist(ewb[,name])
}
```

This code appears to work, but the titles are all messed up. I have to use a for loop with a different syntax to put the column names on the graphs.

```{r}
for (i in 1:11) {
  hist(ewb[,name],
       main = paste(colnames(ewb)[i]),
       xlab = "") 
}
```

Perfect! Now I have code that will generate histograms for every variable in a dataset. It may not look like it, but finding the right code for this took me a surprisingly long time.

Next, let's try to implement ggplot2 instead of just using base R. We'll explore this in the context of 2X2 interaction bar plots.

```{r}
dodge <- position_dodge(width=0.9)
#limits <- aes(ymax = mean + (se), ymin=mean - (se))
for (i in 1:length(names)) {
print(ggplot(ewb, aes(x = MEANDEP, y = mean(MEANPFR), fill = ACMPLM36))+
  geom_bar(stat='identity', position=dodge)+
  #geom_errorbar(limits, position=dodge, width=0.25)+
  labs(y="Estimation of Hours Saved", x= "Gain/Save Frame",
       title = "Effect of Time Frame on Estimation of Hours Saved")+
  scale_fill_hue(name="Frame", 
                 breaks=c("event","time"),
                 labels=c("Event", "Time")) )
}
```

```{r}
set.seed(154)
D <- data.frame(
    x1 = runif(100),
    x2 = rnorm(100)
)

library(ggplot2)
plots <- list()
for(nm in names(D)) {
    plots[[nm]] <- ggplot(data=D) + geom_density(aes_string(x=nm))
}

print(plots[["x1"]])
print(plots[["x2"]])
# works
```


```{r}
# lapply(names(ewb)[ncol(ewb)], function(x) {
#     ewb_data <- ewb[, c(x, 'MEANDEP')]
#     names(ewb_data)[1] <- 'Var'
# 
#     ggplot(ewb_data, aes(x=Var, fill=factor(Var))) +
#       geom_bar() + 
#       facet_grid(~MEANDEP) +
#       theme_bw()
#   })
```

```{r}
# plotHistFunc <- function(x, na.rm = TRUE, ...) {
#   nm <- names(x)
#   for (i in seq_along(nm)) {
# plots <-ggplot(x,aes_string(x = nm[i])) + geom_histogram(alpha = .5,fill = "dodgerblue")
# ggsave(plots,filename=paste("myplot",nm[i],".png",sep=""))
#   }
# }
#  
# plotHistFunc(df)
```

```{r}
dat <- read.table(text="Method  Metric  E0  E1  E2  E4
M1  Precision   0.9661017   0.9622642   1   0.9655172
M2  Precision   0.533   0.535   0.378   0.214
M1  Recall  0.9736842   0.9736842   0.9473684   0.9473684
M2  Recall  1   1   1   0.667",header=TRUE)

layout(matrix(c(1,2,5,3,4,5),nrow=2,byrow = TRUE))
#     [,1] [,2] [,3]
#[1,]    1    2    5
#[2,]    3    4    5
barcols <- c("red","blue")

sapply(3:6, 
  function(x) {
    bp <- barplot(matrix(dat[,x],nrow=2,byrow=TRUE),beside=TRUE,col=barcols)
    title(main=names(dat[x]))
    axis(1,at=colMeans(bp),c("M1","M2"),lwd=0,lwd.tick=1)
    abline(h=0)
  }
)
# works
```


Now, we will move onto the last task: working with a nested dataframe.






<h4>Process</h4>
I had to do some online research into how for loops work.
Figuring out how to get the right titles onto the automated plots was tricky and took a lot of trial and error. Methods that I thought should have worked simply did not.

